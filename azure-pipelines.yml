
# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master
- feature/*

pool:
  vmImage: ubuntu-latest
  name: default

variables:
  major: 1
  minor: 1
  patch: $[counter(variables['minor'], 0)]
  NugetVersion: $(major).$(minor).$(patch)
  TagVersion: $(NugetVersion)-tt

steps:
- task: Bash@3
  displayName: "versioning"
  inputs:
    targetType: inline
    script: |
          echo 'VERSION ' $VERSION
          if [ $(Build.SourceBranchName) = "master" ]; then
            VERSION=$(NugetVersion)
          else
            VERSION=$(NugetVersion)-beta
          fi;
          echo '##vso[task.setVariable variable=TagVersion]$VERSION'

- task: Bash@3
  displayName: "Adding git"
  inputs:
    targetType: inline
    script: |
            echo 'TAG ' $TagVersion
            echo 'Source version ' $(Build.SourceVersion)
            echo 'Source BranchName ' $(Build.SourceBranchName)
            git tag $(TAGVERSION) $(Build.SourceVersion)
            git push origin $(TAGVERSION)